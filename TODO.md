- fix before() function, which is subtly broken
- explain the regex invariant.
